

<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="renderer" content="webkit">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="description" content="但行好事 莫问前程">

	
		
			<link rel="stylesheet" href="/bower_components/fancybox/source/jquery.fancybox.css">
		
		<link rel="stylesheet" href="/bower_components/font-awesome/css/font-awesome.min.css">
		<link rel="stylesheet" href="/css/style.css">
	

	<title>但行好事 莫问前程 - 明羽</title>
<meta name="generator" content="Hexo 4.2.1"></head>
<body>
<header id="header">
	<div class="center">
		<div class="wrap">
			<div id="site">
				<h1>
					<a href="/">但行好事 莫问前程</a>
					
						<a class="github" href="https://github.com/dnxbf321" target="_blank" rel="noopener">
	  					<svg aria-hidden="true" class="octicon octicon-mark-github" height="28" role="img" version="1.1" viewBox="0 0 16 16" width="28"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59 0.4 0.07 0.55-0.17 0.55-0.38 0-0.19-0.01-0.82-0.01-1.49-2.01 0.37-2.53-0.49-2.69-0.94-0.09-0.23-0.48-0.94-0.82-1.13-0.28-0.15-0.68-0.52-0.01-0.53 0.63-0.01 1.08 0.58 1.23 0.82 0.72 1.21 1.87 0.87 2.33 0.66 0.07-0.52 0.28-0.87 0.51-1.07-1.78-0.2-3.64-0.89-3.64-3.95 0-0.87 0.31-1.59 0.82-2.15-0.08-0.2-0.36-1.02 0.08-2.12 0 0 0.67-0.21 2.2 0.82 0.64-0.18 1.32-0.27 2-0.27 0.68 0 1.36 0.09 2 0.27 1.53-1.04 2.2-0.82 2.2-0.82 0.44 1.1 0.16 1.92 0.08 2.12 0.51 0.56 0.82 1.27 0.82 2.15 0 3.07-1.87 3.75-3.65 3.95 0.29 0.25 0.54 0.73 0.54 1.48 0 1.07-0.01 1.93-0.01 2.2 0 0.21 0.15 0.46 0.55 0.38C13.71 14.53 16 11.53 16 8 16 3.58 12.42 0 8 0z"></path></svg>
						</a>
					
				</h1>
				
					<h2>
						<a href="/">明羽</a>
					</h2>
				
			</div>
			<nav id="menu">
				<ul>
					
						<li><a href="/">首页</a></li>
					
						<li><a href="/archives/">归档</a></li>
					
				</ul>
			</nav>
		</div>
	</div>
</header>

<div id="content">
	<div class="center">
		<div class="main-col">
			

	
	<article class="post">
	<div class="post-content">
		<header>
			
				<div class="meta">
					<div class="icon">
						
							<i class="fa fa-file"></i>
						
					</div>
					<time datetime="2019-09-17T09:58:30.000Z">2019-09-17</time>
				</div>
			
			
	
		<h1 class="title">【jvm】内存区域</h1>
	

		</header>
		<div class="entry">
			
				<p>​    jvm在执行的过程中会把它所管理的内存划分为若干个不同的数据区域，这些数据区域中，有些依赖着用户线程的启动和结束而建立和销毁，有些则随着jvm进程的启动而创建</p>
<h3 id="内存区域"><a href="#内存区域" class="headerlink" title="内存区域"></a>内存区域</h3><p>jvm的运行数据区域可以分为两种：线程私有和线程共享</p>
<p>线程私有: 每个线程的私有数据，包括: 程序计数器、java虚拟机栈、本地方法栈</p>
<p>线程共享: 所有线程共享的部分，包括:  Java 堆、方法区、常量池</p>
<p><strong>jvm内存区域划图示</strong></p>
<p><img src="/jvm-memory/jvm-memory%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F.png" alt></p>
<h3 id="运行时数据区域"><a href="#运行时数据区域" class="headerlink" title="运行时数据区域"></a>运行时数据区域</h3><h4 id="程序计数器"><a href="#程序计数器" class="headerlink" title="程序计数器"></a>程序计数器</h4><p>程序计数器是较小的内存空间，它可以看做是当前线程所执行的字节码的行号指示器，用来执行选取小一条需要执行的字节码指令，属于线程私有的内存</p>
<p>如果执行的是一个java方法，这个计数器记录的是正在执行的虚拟机字节码指令地址，如果执行的是Native方法，这个计数器值为空</p>
<h4 id="虚拟机栈"><a href="#虚拟机栈" class="headerlink" title="虚拟机栈"></a>虚拟机栈</h4><p>虚拟机栈，也是线程私有的，它的生命周期与线程相同，每个方法在执行时都创建一个栈帧，每个方法从调用到执行完成，对应着一个栈帧的入栈到出栈</p>
<p>虚拟机栈描述的是java方法执行的动态内存模型</p>
<p>栈帧存储的数据包括: 局部变量表，操作数栈，动态链接，方法出口等信息</p>
<p>在虚拟机栈中，规定了两种异常：</p>
<ol>
<li>当栈调用深度大于JVM所允许的范围，会抛出StackOverflowError的错误</li>
<li>当虚拟机栈在扩展内存时无法申请到足够的内存，会抛出OutOfMemoryError异常</li>
</ol>
<h4 id="本地方法栈"><a href="#本地方法栈" class="headerlink" title="本地方法栈"></a>本地方法栈</h4><p>线程私有，与虚拟机栈提供的功能类似，只不过执行的是本地方法，也就是用Native修饰的方法</p>
<h4 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h4><p>堆是被线程共享的一块内存区域，随着jvm的启动而创建，用来存放对象实例和数组</p>
<p>这块区域也是GC进行垃圾回收的主要区域，当申请不到空间时会抛出 OutOfMemoryError异常</p>
<p>堆可以细分为新生代和老年代，新生代用来存放存活时间较短的对象，老年代用来存放存活时间较长的对象，新生代还可以细分为一个Eden区和两个Survivor；</p>
<h4 id="方法区"><a href="#方法区" class="headerlink" title="方法区"></a>方法区</h4><p>方法区也是被线程共享的一块内存区域，用来存虚拟机中加载的类信息，常量，静态变量，即时编译器编译后的代码等数据</p>
<p>方法区是jvm的规范，而接下来要说的永久代和元空间正式jvm规范的一种实现</p>
<p><strong>永久代（Permanent Space）</strong></p>
<p>在jdk1.7时，方法区被叫做永久代（Permanent Space），由于方法区主要存储类的相关信息，所以对于动态生成类的情况比较容易出现永久代的内存溢出，当永久代出现内存溢出，会抛出java.lang.OutOfMemoryError: PermGen space异常</p>
<p><strong>元空间（MetaSpace）</strong></p>
<p>在jdk1.8中移除了永久代，使用元空间代替，jdk1.7中，存储在永久代的部分数据就已经转移到了堆内存或者是直接内存。但永久代仍存在于jdk1.7中，并没完全移除，譬如符号引用(Symbols)转移到了直接内存；字面量(interned strings)，类的静态变量(class statics)转移到了堆内存</p>
<p>元空间的本质和永久代类似，都是对JVM规范中方法区的实现。不过元空间与永久代之间最大的区别在于：元空间并不在虚拟机中，而是使用本地内存。因此，默认情况下，元空间的大小仅受本地内存限制，但可以通过以下参数来指定元空间的大小：</p>
<ul>
<li>-XX:MetaspaceSize，初始空间大小，达到该值就会触发垃圾收集进行类型卸载，同时GC会对该值进行调整：如果释放了大量的空间，就适当降低该值；如果释放了很少的空间，那么在不超过MaxMetaspaceSize时，适当提高该值。</li>
<li>-XX:MaxMetaspaceSize，最大空间，默认是没有限制的，最大内存受本地内存的限制</li>
</ul>

			
		</div>
		<footer class="clearfix">
			
			
	<div class="categories">
		<i class="fa fa-folder"></i>
		
			<a href="/categories/jvm/">jvm</a>
		
	</div>

			
	<div class="tags">
		<i class="fa fa-tags"></i>
		
			<a href="/tags/jvm%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F/">#jvm内存区域</a>
		
	</div>

		</footer>
	</div>
</article>

	
<section id="comment">
	<div id="disqus_thread"></div>
</section>
<script>
	(function (disqus_shortname) {
		window.addEventListener('DOMContentLoaded', function () {
			var dsq = document.createElement('script');
			dsq.type = 'text/javascript';
			dsq.async = true;
			dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
			document.getElementsByTagName('head')[0].appendChild(dsq);
		}, false);
	}('dnxbf321'));
</script>



		</div>
		

	
	<a href="https://chenmingyu.top/jvm-gc-collector/" id="postPrev" class="icon fa fa-chevron-left"></a>


	<a href="https://chenmingyu.top/jvm-gc/" id="postNext" class="icon fa fa-chevron-right"></a>



	</div>
</div>

<footer id="footer">
	<div class="center">
		&copy; 2022
		
			明羽
		.
		&nbsp;&nbsp;
		Blog generated by <a href="http://hexo.io" target="_blank" rel="noopener">hexo</a>
	</div>
</footer>

<script src="/bower_components/jquery/dist/jquery.min.js"></script>
<script src="/js/header-animate.js"></script>



<script src="/bower_components/jquery_lazyload/jquery.lazyload.js"></script>
<script>
	$('img.lazy').lazyload();
</script>

	<script src="/bower_components/fancybox/source/jquery.fancybox.pack.js"></script>
	<script>
		$('.fancybox').fancybox();
	</script>




</body>
</html>